<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configurar Acesso - Synapse PRO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #050505; color: white; }
        .input-field { background: #111; border: 1px solid #333; color: white; width: 100%; padding: 16px; border-radius: 12px; outline: none; transition: all 0.3s; }
        .input-field:focus { border-color: #22c55e; box-shadow: 0 0 15px rgba(34, 197, 94, 0.1); }
        .btn-start { background: #22c55e; color: black; font-weight: 900; width: 100%; padding: 16px; border-radius: 12px; text-transform: uppercase; cursor: pointer; transition: transform 0.1s; }
        .btn-start:hover { background: #16a34a; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center px-6">

    <div class="w-full max-w-md text-center">
        <div class="mb-8">
            <div class="inline-block p-4 rounded-full bg-green-500/10 mb-4 text-green-500 border border-green-500/20">
                <i class="fas fa-check text-4xl"></i>
            </div>
            <h1 class="text-3xl font-black text-white mb-2">Pagamento Confirmado!</h1>
            <p class="text-gray-400 text-sm">Finalize seu cadastro para entrar.</p>
        </div>

        <form id="authForm" class="space-y-4 bg-[#0A0A0A] p-8 rounded-2xl border border-white/10 shadow-2xl text-left">
            <div>
                <label class="text-xs text-gray-500 font-bold ml-1 mb-1 block">NOME</label>
                <input type="text" id="name" class="input-field" required placeholder="Seu nome">
            </div>
            <div>
                <label class="text-xs text-gray-500 font-bold ml-1 mb-1 block">E-MAIL DA COMPRA</label>
                <input type="email" id="email" class="input-field" required placeholder="email@exemplo.com">
            </div>
            <div>
                <label class="text-xs text-gray-500 font-bold ml-1 mb-1 block">DEFINIR SENHA</label>
                <input type="password" id="password" class="input-field" required placeholder="******">
            </div>
            
            <p id="msg-erro" class="text-red-500 text-sm font-bold text-center hidden"></p>

            <button type="submit" id="btnSubmit" class="btn-start mt-4 w-full">
                LIBERAR ACESSO <i class="fas fa-unlock ml-2"></i>
            </button>
        </form>
    </div>

    <script>
        // SEU LINK DO SHEETDB
        const API_URL = 'https://sheetdb.io/api/v1/eplcagfbxnfje'; 

        document.getElementById('authForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const btn = document.getElementById('btnSubmit');
            const msg = document.getElementById('msg-erro');
            const email = document.getElementById('email').value.trim().toLowerCase();
            const name = document.getElementById('name').value;

            // Bloqueia botão
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> VALIDANDO...';
            msg.classList.add('hidden');

            try {
                // Verifica na planilha se o email existe
                const res = await fetch(`${API_URL}/search?email=${email}`);
                const data = await res.json();

                if (data.length > 0) {
                    // SUCESSO!
                    // 1. Salva o "token" no navegador
                    localStorage.setItem('synapse_access', JSON.stringify({
                        user: name,
                        email: email,
                        valid: true,
                        date: new Date().getTime()
                    }));

                    btn.style.backgroundColor = '#22c55e';
                    btn.innerHTML = '<i class="fas fa-check"></i> ACESSO LIBERADO!';
                    
                    // 2. Redireciona para a ferramenta
                    setTimeout(() => {
                        window.location.href = 'index.html'; 
                    }, 1500);
                } else {
                    // ERRO
                    msg.innerText = "E-mail não encontrado na lista de compradores.";
                    msg.classList.remove('hidden');
                    btn.disabled = false;
                    btn.innerHTML = 'TENTAR NOVAMENTE';
                }
            } catch (err) {
                console.error(err);
                msg.innerText = "Erro de conexão.";
                msg.classList.remove('hidden');
                btn.disabled = false;
                btn.innerHTML = 'TENTAR NOVAMENTE';
            }
        });
    </script>
</body>
</html>