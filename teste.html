<!DOCTYPE html>
<html lang="pt-BR" class="h-full">
<head>
    <link rel="shortcut icon" href="assets/icone preto.png" type="image/jpeg">
    <link rel="icon" href="assets/icone preto.png" type="image/jpeg">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, interactive-widget=resizes-content, maximum-scale=1">
    <title>Synapse - Demonstra√ß√£o Gratuita</title>
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <!-- Bibliotecas Externas -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        /* --- ESTILOS GERAIS --- */
        body { font-family: 'Inter', sans-serif; background-color: #0a0a0a; color: #ffffff; margin: 0; padding: 0; overflow: hidden; -webkit-tap-highlight-color: transparent; }
        .brutal-red { color: #CC0000; }
        .bg-brutal-red { background-color: #CC0000; }
        .font-mono-code { font-family: 'JetBrains Mono', monospace; }

        /* LAYOUT */
        .app-layout { display: grid; grid-template-columns: 280px 1fr; height: 100dvh; width: 100%; overflow: hidden; }

        /* SIDEBAR */
        .sidebar { background-color: #111; border-right: 1px solid #222; display: flex; flex-direction: column; height: 100%; overflow-y: auto; z-index: 100; transition: transform 0.3s ease; box-shadow: 5px 0 30px rgba(0,0,0,0.8); }

        .tool-item { display: flex; align-items: center; padding: 14px 16px; margin-bottom: 4px; border-radius: 12px; color: #a3a3a3; font-size: 0.95rem; font-weight: 500; cursor: pointer; transition: all 0.2s; width: 100%; }
        .tool-item:hover { background-color: #1a1a1a; color: #fff; }
        .tool-item.active { background-color: #1f1f1f; color: #CC0000; font-weight: 600; border-left: 3px solid #CC0000; }
        .tool-item.locked { opacity: 0.5; position: relative; }
        .tool-item.locked::after { content: '\f023'; font-family: "Font Awesome 6 Free"; font-weight: 900; position: absolute; right: 15px; font-size: 10px; color: #666; }
        
        /* ANIMA√á√ÉO TOOL SLIDE IN */
        @keyframes slideInTool { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } }
        .tool-animate { animation: slideInTool 0.5s ease-out forwards; opacity: 0; }
        .tool-animate:nth-child(1) { animation-delay: 0.1s; }
        .tool-animate:nth-child(2) { animation-delay: 0.2s; }
        .tool-animate:nth-child(3) { animation-delay: 0.3s; }
        .tool-animate:nth-child(4) { animation-delay: 0.4s; }
        .tool-animate:nth-child(5) { animation-delay: 0.5s; }

        /* CHAT AREA & MESSAGES */
        .chat-area { display: flex; flex-direction: column; background-color: #000000; background-image: radial-gradient(#1a1a1a 1px, transparent 1px); background-size: 24px 24px; height: 100%; position: relative; overflow: hidden; }
        .chat-messages { flex-grow: 1; overflow-y: auto; scroll-behavior: smooth; display: flex; flex-direction: column; padding: 0 16px; padding-bottom: 100px; }
        #messagesContainer { display: flex; flex-direction: column; gap: 12px; width: 100%; max-width: 42rem; margin: 0 auto; padding-top: 10px; }

        .chat-message-user { background-color: #CC0000; color: #fff; align-self: flex-end; border-radius: 18px 18px 4px 18px; padding: 10px 14px; max-width: 85%; font-size: 0.95rem; line-height: 1.4; box-shadow: 0 2px 5px rgba(0,0,0,0.2); animation: fadeIn 0.2s; word-wrap: break-word; }
        .chat-message-ia { background-color: transparent; color: #F2F2F2; align-self: flex-start; padding: 0; margin-left: 2px; max-width: 95%; font-size: 0.95rem; line-height: 1.5; animation: fadeIn 0.2s; word-wrap: break-word; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* BOT√ïES & INPUT */
        .quick-reply-container { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; max-width: 95%; align-self: flex-start; margin-top: 4px; margin-bottom: 12px; }
        .cyber-btn { background-color: #1E1E1E; color: #e0e0e0; font-weight: 600; font-size: 0.85rem; padding: 12px 8px; border-radius: 12px; border: none; border-bottom: 4px solid #000000; transition: all 0.1s; cursor: pointer; text-align: center; }
        .cyber-btn:active { transform: translateY(3px); border-bottom-width: 1px; background-color: #252525; }
        .cyber-btn:last-child:nth-child(odd) { grid-column: 1 / -1; }

        .chat-input-container { position: absolute; bottom: 0; left: 0; right: 0; background-color: #000; padding: 15px; border-top: 1px solid #222; z-index: 30; display: flex; align-items: center; transition: opacity 0.5s; }
        .chat-input-container.hidden-input { opacity: 0; pointer-events: none; }
        
        #textInputWrapper { background-color: #1a1a1a; border-radius: 24px; border: 1px solid #333; padding: 8px 14px; display: flex; align-items: center; width: 100%; box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
        #chatInput { font-size: 0.95rem; color: #fff; width: 100%; background: transparent; outline: none; }
        #sendBtn { width: 36px; height: 36px; border-radius: 50%; background-color: #CC0000; display: flex; align-items: center; justify-content: center; margin-left: 8px; flex-shrink: 0; box-shadow: 0 2px 5px rgba(0,0,0,0.3); cursor: pointer; }

        /* DASHBOARD STYLES */
        .dashboard-card { background: #0f0f0f; border: 1px solid rgba(255,255,255,0.05); border-radius: 24px; transition: transform 0.2s, box-shadow 0.2s; }
        .dashboard-card:hover { transform: translateY(-2px); box-shadow: 0 10px 30px -10px rgba(0,0,0,0.5); border-color: rgba(255,255,255,0.1); }
        .circle-chart { position: relative; width: 100px; height: 100px; border-radius: 50%; background: conic-gradient(#CC0000 var(--percentage), #222 0); display: flex; align-items: center; justify-content: center; }
        .circle-chart::after { content: ''; position: absolute; width: 80%; height: 80%; background: #0f0f0f; border-radius: 50%; }
        .circle-content { position: relative; z-index: 10; text-align: center; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #111; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }

        /* BANNER PAYWALL NO CHAT (Pequeno) */
        .paywall-card { background: #0f0f0f; border: 1px solid rgba(204, 0, 0, 0.3); border-radius: 16px; padding: 20px; text-align: center; margin-top: 20px; box-shadow: 0 0 20px rgba(204,0,0,0.1); animation: fadeIn 0.5s ease; position: relative; overflow: hidden; }
        .paywall-card::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 4px; background: linear-gradient(90deg, #990000, #ff0000, #990000); }

        /* MOBILE RESPONSIVO */
        @media (max-width: 768px) {
            .app-layout { display: flex; flex-direction: column; }
            .sidebar { position: fixed; top: 0; left: 0; height: 100%; width: 85%; max-width: 300px; transform: translateX(-100%); display: flex !important; }
            .sidebar-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 40; visibility: hidden; opacity: 0; transition: opacity 0.3s; }
            .chat-input-container { bottom: 70px; background: transparent; border: none; padding: 0 10px 10px 10px; }
            .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; height: 65px; background: rgba(10, 10, 10, 0.95); backdrop-filter: blur(12px); border-top: 1px solid rgba(255,255,255,0.08); display: flex; justify-content: space-around; align-items: center; z-index: 50; padding-bottom: env(safe-area-inset-bottom); }
            .nav-btn { background: none; border: none; color: #666; display: flex; flex-direction: column; align-items: center; justify-content: center; width: 50%; height: 100%; }
            .nav-btn.active { color: #CC0000; }
        }
        
        .anim-active .day-cell { animation: softLift 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes softLift { 0% { opacity: 0; transform: translateY(10px); } 100% { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }

        /* ANIMA√á√ÉO P√ÇNICO (Progress Bar) */
        @keyframes progressFill { from { width: 0%; } to { width: 100%; } }
        .animate-progress-fill { animation: progressFill 3s ease-out forwards; }
        .blink-slow { animation: blink 1.5s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }
        
        /* BACKGROUND DA ANIMA√á√ÉO DE CARREGAMENTO */
        .bg-scan-overlay {
            background-color: #000;
            background-image: 
                radial-gradient(circle at center, rgba(100, 0, 0, 0.1) 0%, transparent 70%),
                linear-gradient(rgba(20, 0, 0, 0.5) 1px, transparent 1px),
                linear-gradient(90deg, rgba(20, 0, 0, 0.5) 1px, transparent 1px);
            background-size: 100% 100%, 20px 20px, 20px 20px;
        }

        /* EFEITO GLOW TEXTO VERMELHO */
        .text-glow-red { text-shadow: 0 0 15px rgba(220, 38, 38, 0.8); }
    </style>
</head>

<body class="h-full bg-black text-white font-inter overflow-hidden">

    <div id="sidebarOverlay" class="sidebar-overlay"></div>

    <div class="app-layout">

        <!-- SIDEBAR -->
        <aside id="sidebar" class="sidebar bg-black flex flex-col h-full font-inter w-[280px] p-2 gap-2 overflow-hidden fixed md:relative z-[100] md:z-auto transition-transform duration-300 md:translate-x-0 -translate-x-full"> 
            
            <div class="bg-[#121212] rounded-lg p-5 flex flex-col gap-5">
                <div class="flex justify-between items-center">
                    <div class="flex items-center gap-2 cursor-pointer hover:opacity-80 transition">
                        <img src="assets/icone preto.png" alt="Logo" class="w-6 h-6 object-contain invert">
                        <span class="font-bold text-white tracking-tight text-sm">Synapse</span>
                    </div>
                    <button onclick="toggleSidebar()" class="md:hidden text-gray-400 hover:text-white p-2">
                        <i class="fa-solid fa-xmark text-2xl"></i>
                    </button>
                </div>

                <nav class="space-y-1">
                    <!-- BOT√ÉO ALTERADO PARA JORNADA -->
                    <div onclick="switchTab('protocolo'); closeSidebar()" class="flex items-center gap-4 px-3 py-2 text-gray-400 hover:text-white hover:bg-[#1a1a1a] rounded-md cursor-pointer transition font-bold text-sm group">
                        <div class="w-6 text-center"><i class="fa-solid fa-layer-group text-lg group-hover:text-white transition"></i></div>
                        <span>Jornada</span>
                    </div>
                </nav>
            </div>

            <div class="bg-[#121212] rounded-lg flex-grow flex flex-col overflow-hidden relative">
                
                <div class="p-4 shadow-sm z-10 bg-[#121212] border-b border-white/5">
                    <div class="flex justify-between items-center text-gray-400 hover:text-white transition cursor-pointer group">
                        <div class="flex items-center gap-2">
                            <i class="fa-solid fa-layer-group text-lg group-hover:text-white transition"></i>
                            <span class="font-bold text-sm group-hover:text-white transition">Seu Arsenal</span>
                        </div>
                        <div class="flex gap-3">
                            <i class="fa-solid fa-plus hover:bg-[#1a1a1a] rounded-full p-1 transition cursor-pointer" onclick="showLockedFeature('Personalizar Arsenal')"></i>
                        </div>
                    </div>
                </div>

                <div class="overflow-y-auto px-2 py-4 space-y-1 hover:overflow-y-auto custom-scrollbar">
                    
                    <div onclick="selectTool('Diagnostico'); closeSidebar()" class="flex items-center gap-3 p-2 rounded-md hover:bg-[#1a1a1a] cursor-pointer group transition tool-animate">
                        <div class="w-10 h-10 bg-gradient-to-br from-[#CC0000] to-[#990000] rounded-md flex items-center justify-center flex-shrink-0 shadow-lg">
                            <i class="fa-solid fa-chart-line text-white text-lg"></i>
                        </div>
                        <div class="overflow-hidden">
                            <p class="text-white font-bold text-sm truncate group-hover:text-green-400 transition mb-0.5">Diagn√≥stico</p>
                            <p class="text-[10px] text-gray-400 truncate flex items-center gap-1">
                                <span class="text-green-500 text-[6px]">‚óè</span> IA Ativa
                            </p>
                        </div>
                    </div>

                    <!-- Ferramentas PRO -->
                    <div onclick="selectTool('Comandante'); closeSidebar()" class="flex items-center gap-3 p-2 rounded-md hover:bg-[#1a1a1a] cursor-pointer group transition tool-item locked tool-animate">
                        <div class="w-10 h-10 bg-[#282828] rounded-md flex items-center justify-center flex-shrink-0">
                            <i class="fa-solid fa-skull text-gray-400 text-lg"></i>
                        </div>
                        <div class="overflow-hidden flex-grow">
                            <p class="text-white font-bold text-sm truncate">Comandante</p>
                            <p class="text-[10px] text-gray-500 truncate">PRO</p>
                        </div>
                    </div>

                    <div onclick="selectTool('General'); closeSidebar()" class="flex items-center gap-3 p-2 rounded-md hover:bg-[#1a1a1a] cursor-pointer group transition tool-item locked tool-animate">
                        <div class="w-10 h-10 bg-[#282828] rounded-md flex items-center justify-center flex-shrink-0">
                            <i class="fa-solid fa-chess-knight text-gray-400 text-lg"></i>
                        </div>
                        <div class="overflow-hidden flex-grow">
                            <p class="text-white font-bold text-sm truncate">General</p>
                            <p class="text-[10px] text-gray-500 truncate">PRO</p>
                        </div>
                    </div>

                    <div onclick="selectTool('Tatico'); closeSidebar()" class="flex items-center gap-3 p-2 rounded-md hover:bg-[#1a1a1a] cursor-pointer group transition tool-item locked tool-animate">
                        <div class="w-10 h-10 bg-[#282828] rounded-md flex items-center justify-center flex-shrink-0">
                            <i class="fa-solid fa-satellite-dish text-gray-400 text-lg"></i>
                        </div>
                        <div class="overflow-hidden flex-grow">
                            <p class="text-white font-bold text-sm truncate">T√°tico</p>
                            <p class="text-[10px] text-gray-500 truncate">PRO</p>
                        </div>
                    </div>

                    <div onclick="selectTool('Panico'); closeSidebar()" class="flex items-center gap-3 p-2 rounded-md hover:bg-[#1a1a1a] cursor-pointer group transition mt-2 tool-animate">
                        <div class="w-10 h-10 bg-gradient-to-br from-[#450a0a] to-red-900 rounded-md flex items-center justify-center flex-shrink-0 shadow-red-900/20">
                            <i class="fa-solid fa-triangle-exclamation text-red-200 text-lg animate-pulse"></i>
                        </div>
                        <div class="overflow-hidden">
                            <p class="text-white font-bold text-sm truncate group-hover:text-red-400 transition mb-0.5">Bot√£o do P√¢nico</p>
                            <p class="text-[10px] text-gray-400 truncate">Emerg√™ncia</p>
                        </div>
                    </div>

                </div>
            </div>
            
            <!-- RODAP√â SIDEBAR PREMIUM (Restaurado) -->
            <div class="mt-auto">
                <div onclick="window.location.href='index.html#planos'" class="bg-gradient-to-r from-[#901c1c] to-[#b91c1c] p-[1px] rounded-lg cursor-pointer hover:scale-[1.02] transition shadow-lg group border border-[#222]">
                    <div class="bg-[#000] p-3 rounded-[7px] h-full flex items-center gap-3 relative overflow-hidden">
                        <div class="w-10 h-10 bg-[#333] rounded shadow-lg flex-shrink-0 relative z-10 flex items-center justify-center">
                            <img src="assets/icone preto.png" class="w-full h-full object-cover invert opacity-80 p-1">
                        </div>
                        
                        <div class="flex-grow z-10 overflow-hidden">
                            <div class="flex items-center gap-2">
                                 <p class="text-white font-bold text-xs truncate">Synapse Premium</p>
                                 <span class="bg-white text-black text-[8px] font-black px-1 rounded uppercase">PRO</span>
                            </div>
                            <p class="text-gray-400 text-[10px] truncate group-hover:text-white transition-colors">
                                Desbloquear 4 Agentes
                            </p>
                        </div>
                        
                        <div class="z-10">
                            <i class="fa-solid fa-chevron-up text-gray-400"></i>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- MAIN AREA -->
        <main class="chat-area relative flex flex-col h-full bg-[#000]">

            <!-- Mobile Header -->
            <div id="mobileHeader" class="md:hidden fixed top-0 left-0 right-0 h-14 bg-black/80 backdrop-blur-xl border-b border-[#1a1a1a] z-30 flex items-center px-4 justify-between transition-transform duration-300">
                <button id="menuBtn" class="text-gray-400 hover:text-white transition p-2" onclick="toggleSidebar()">
                    <i data-lucide="menu" class="w-5 h-5"></i>
                </button>
                <h3 class="text-xs font-bold uppercase tracking-widest text-white" id="mobileTitle">Synapse</h3>
                <div class="w-9"></div> 
            </div>

            <!-- VIEW: CHAT -->
            <div id="viewChat" class="view-section h-full flex flex-col">
                <div class="chat-messages flex-grow pt-16"> 
                    <div id="messagesContainer" class="pb-24 w-full max-w-2xl mx-auto flex flex-col"></div>
                </div>

                <div class="chat-input-container">
                    <div class="w-full max-w-2xl mx-auto">
                        <div id="textInputWrapper">
                            <textarea id="chatInput" rows="1" class="bg-transparent w-full text-sm text-white outline-none resize-none max-h-24 placeholder-gray-600 font-inter" placeholder="Digite seu comando..."></textarea>
                            <button id="sendBtn" class="hover:bg-red-700 transition"><i data-lucide="arrow-up" class="w-4 h-4 text-white"></i></button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW: PROTOCOLO / DASHBOARD (DESBLOQUEADO - COM PADDING AJUSTADO) -->
            <div id="viewProtocolo" class="view-section h-full hidden overflow-y-auto bg-[#050505] p-5 pb-24 pt-20 relative z-10">
                
                <div class="w-full max-w-md md:max-w-6xl mx-auto relative transition-all duration-500">
                    
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-end mb-8 gap-4">
                        <div>
                            <h2 class="text-2xl md:text-3xl font-bold text-white tracking-tight">QG Operacional</h2>
                            <p class="text-xs text-gray-500 mt-1">Bem-vindo, <span id="userNameDashboard" class="text-gray-300 font-bold">Visitante</span>.</p>
                        </div>
                        
                        <div class="flex gap-3">
                            <button id="btnRelatorio" class="bg-[#1a1a1a] hover:bg-[#222] text-white px-4 py-2 rounded-full text-xs font-bold transition flex items-center gap-2 border border-white/5 opacity-50 cursor-not-allowed">
                                <i class="fa-solid fa-lock text-xs"></i> Relat√≥rio
                            </button>
                            <button id="btnFoco" class="bg-[#CC0000] hover:bg-red-600 text-white px-5 py-2 rounded-full text-xs font-bold transition shadow-lg shadow-red-900/20 flex items-center gap-2 opacity-50 cursor-not-allowed">
                                <i class="fa-solid fa-lock"></i> Iniciar Foco
                            </button>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                        <div class="dashboard-card p-5 flex flex-col justify-between">
                            <div class="flex justify-between items-start">
                                <div class="w-8 h-8 rounded-full bg-blue-900/20 flex items-center justify-center text-blue-500"><i class="fa-solid fa-trophy text-xs"></i></div>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-white mt-2" id="levelDisplay">N√≠vel 1</div>
                                <div class="w-full bg-[#222] rounded-full h-1 mt-2 overflow-hidden">
                                    <div id="xpBar" class="bg-blue-600 h-full w-[0%] transition-all duration-500"></div>
                                </div>
                                <div class="text-[10px] text-gray-500 mt-1">Modo Demo</div>
                            </div>
                        </div>

                        <div class="dashboard-card p-5 flex flex-col justify-between">
                            <div class="flex justify-between items-start">
                                <div class="w-8 h-8 rounded-full bg-orange-900/20 flex items-center justify-center text-orange-500"><i class="fa-solid fa-fire text-xs"></i></div>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-white mt-2">0 Dias</div>
                                <div class="text-[10px] text-gray-500">Sequ√™ncia (Bloqueado)</div>
                            </div>
                        </div>

                        <div class="dashboard-card p-5 flex flex-col justify-between">
                            <div class="flex justify-between items-start">
                                <div class="w-8 h-8 rounded-full bg-purple-900/20 flex items-center justify-center text-purple-500"><i class="fa-solid fa-brain text-xs"></i></div>
                            </div>
                            <div>
                                <div class="w-full bg-[#222] rounded-full h-1.5 mt-3 mb-1 overflow-hidden">
                                    <div class="bg-purple-500 h-full w-[35%] rounded-full animate-pulse"></div>
                                </div>
                                <div class="text-[10px] text-gray-400 flex justify-between">
                                    <span>Sistema</span>
                                    <span class="text-yellow-500">Trial</span>
                                </div>
                            </div>
                        </div>

                        <div class="dashboard-card p-4 flex items-center justify-between">
                            <div>
                                <div class="text-xs text-gray-400 mb-1">Miss√µes Hoje</div>
                                <div class="text-xl font-bold text-white" id="dailyMetaText">0/1</div>
                            </div>
                            <div class="circle-chart" style="--percentage: 0deg; width: 60px; height: 60px;">
                                <div class="circle-content text-[10px] font-bold text-white">0%</div>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        
                        <div class="dashboard-card p-6 lg:col-span-1 h-[400px] flex flex-col relative group">
                            
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-sm font-bold text-white"><i class="fa-regular fa-calendar text-gray-500 mr-2"></i>Agenda</h3>
                                <div class="flex gap-2">
                                    <button class="text-gray-400"><i class="fa-solid fa-chevron-left"></i></button>
                                    <button class="text-gray-400"><i class="fa-solid fa-chevron-right"></i></button>
                                </div>
                            </div>
                            
                            <h4 id="cal-month-year" class="text-white font-bold text-center mb-2 capitalize">...</h4>
                            <div class="grid grid-cols-7 gap-1 text-center text-[10px] text-gray-600 font-bold uppercase mb-2">
                                <div>D</div><div>S</div><div>T</div><div>Q</div><div>Q</div><div>S</div><div>S</div>
                            </div>
                            <div id="cal-grid" class="grid grid-cols-7 gap-1 flex-grow overflow-y-auto custom-scrollbar"></div>
                        </div>

                        <div class="dashboard-card p-6 lg:col-span-2 flex flex-col h-[400px]">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-sm font-bold text-white flex items-center gap-2">
                                    <i class="fa-solid fa-list-check text-[#CC0000]"></i> Miss√µes Ativas
                                </h3>
                                <span class="text-[10px] text-gray-500 bg-[#1a1a1a] px-2 py-1 rounded-md border border-yellow-900/30 text-yellow-600">Demo Limitada</span>
                            </div>

                            <div id="tactical-list" class="space-y-2 flex-grow overflow-y-auto pr-2 custom-scrollbar">
                                <p class="text-xs text-gray-600 text-center py-10">Adicione sua primeira miss√£o para testar.</p>
                            </div>

                            <div class="flex gap-2 mt-4 pt-4 border-t border-white/5">
                                <input id="newMissionInput" type="text" class="bg-[#141414] text-sm text-white px-4 py-3 rounded-xl w-full outline-none placeholder-gray-600 focus:border-gray-600 border border-transparent transition" placeholder="Nova miss√£o...">
                                <button id="btnAddBlock" class="bg-[#1a1a1a] hover:bg-[#CC0000] text-gray-400 hover:text-white px-4 rounded-xl transition">
                                    <i class="fa-solid fa-plus"></i>
                                </button>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

        </main>

        <nav class="bottom-nav md:hidden transition-transform duration-300 border-t border-[#1a1a1a]">
            <button id="tabJornada" class="nav-btn" onclick="switchTab('protocolo')">
                <i class="fa-solid fa-layer-group text-lg mb-1"></i>
                <span class="text-[9px] font-medium tracking-wide">JORNADA</span>
            </button>
            <button id="tabChat" class="nav-btn active" onclick="switchTab('chat')">
                <i class="fa-solid fa-terminal text-lg mb-1"></i>
                <span class="text-[9px] font-medium tracking-wide">COMANDO</span>
            </button>
        </nav>
        
    </div>

    <!-- SCRIPT PRINCIPAL UNIFICADO -->
    <script type="module">
        const CONFIG = {
            API_URL: "https://long-block-7f38.kayquedamas.workers.dev",
            API_MODEL: "llama-3.1-8b-instant"
        };

        const IS_DEMO = true;
        let chatMessageCount = 0;
        const CHAT_LIMIT = 3;
        const MISSION_LIMIT = 1;

        // -----------------------------------------------------------
        // 2. M√ìDULO DE NAVEGA√á√ÉO & SELE√á√ÉO
        // -----------------------------------------------------------
        function initNavigation() {
            window.toggleSidebar = toggleSidebar;
            window.switchTab = switchTab;
            window.selectTool = selectTool;
            window.showLockedFeature = showLockedFeature;
            document.getElementById('sidebarOverlay')?.addEventListener('click', toggleSidebar);
        }

        // Fun√ß√£o de sele√ß√£o inteligente
        function selectTool(toolKey) {
            if (window.innerWidth < 768) toggleSidebar();

            if (toolKey === 'Diagnostico') {
                resetChat('Diagnostico'); // Gr√°tis, abre direto
            } else if (toolKey === 'Panico') {
                playPanicSequence(); // Anima√ß√£o exclusiva
            } else {
                showToolBlockedScreen(toolKey); // Bloqueio direto profissional
            }
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            if (!sidebar || !overlay) return;
            const isOpen = sidebar.style.transform === 'translateX(0px)';
            sidebar.style.transform = isOpen ? 'translateX(-100%)' : 'translateX(0px)';
            overlay.style.visibility = isOpen ? 'hidden' : 'visible';
            overlay.style.opacity = isOpen ? '0' : '1';
        }

        function switchTab(tab) {
            const viewChat = document.getElementById('viewChat');
            const viewProtocolo = document.getElementById('viewProtocolo');
            const tabChat = document.getElementById('tabChat');
            const tabJornada = document.getElementById('tabJornada');
            const bottomNav = document.querySelector('.bottom-nav');
            const mobileHeader = document.getElementById('mobileHeader');

            // Reset
            if(tabChat) { tabChat.classList.remove('active'); tabChat.style.color = '#666'; }
            if(tabJornada) { tabJornada.classList.remove('active'); tabJornada.style.color = '#666'; }
            viewChat.classList.add('hidden');
            viewProtocolo.classList.add('hidden');

            // --- NUNCA ESCONDER NAV BAR INFERIOR OU HEADER NO MOBILE ---
            if(bottomNav) bottomNav.style.transform = 'translateY(0)';
            if(mobileHeader) mobileHeader.style.transform = 'translateY(0)';

            if (tab === 'chat') {
                viewChat.classList.remove('hidden');
                if(tabChat) { tabChat.classList.add('active'); tabChat.style.color = '#CC0000'; }
            } else {
                viewProtocolo.classList.remove('hidden');
                if(tabJornada) { tabJornada.classList.add('active'); tabJornada.style.color = '#CC0000'; }
            }
        }

        function showLockedFeature(featureName) {
            alert(`üîí RECURSO BLOQUEADO NA DEMO\n\nO acesso ao m√≥dulo "${featureName}" √© exclusivo para membros PRO.\n\nAssine agora para liberar.`);
        }

        // -----------------------------------------------------------
        // 3. ANIMA√á√ÉO EXCLUSIVA DE P√ÇNICO
        // -----------------------------------------------------------
        function playPanicSequence() {
            switchTab('chat');
            const container = document.getElementById('messagesContainer');
            const inputContainer = document.querySelector('.chat-input-container');
            if(!container) return;

            if(inputContainer) inputContainer.classList.add('hidden-input');
            container.innerHTML = '';
            
            // Anima√ß√£o Dram√°tica "ANALISANDO CRISE"
            const animationHTML = `
                <div class="flex flex-col items-center justify-center h-full text-center fade-in pt-24 bg-scan-overlay fixed inset-0 z-50">
                    <i class="fa-solid fa-biohazard text-5xl text-red-600 mb-6 animate-pulse"></i>
                    <h2 class="text-2xl font-black text-white tracking-widest uppercase mb-2 text-glow-red">ANALISANDO CRISE</h2>
                    <div class="w-48 h-1 bg-gray-800 rounded-full overflow-hidden mb-2 mt-4 border border-red-900/50">
                        <div class="h-full bg-red-600 animate-progress-fill" style="width: 0%"></div>
                    </div>
                    <p class="text-[10px] text-red-500 tracking-widest uppercase blink-slow">DETECTANDO PADR√ÉO DE RECA√çDA...</p>
                </div>
            `;
            
            container.innerHTML = animationHTML;
            
            // Ap√≥s 3s, mostra o bloqueio profissional
            setTimeout(() => {
                showToolBlockedScreen('Protocolo de P√¢nico');
                if(inputContainer) inputContainer.classList.remove('hidden-input');
            }, 3000);
        }

        // -----------------------------------------------------------
        // 4. TELA DE BLOQUEIO PROFISSIONAL (Paywall)
        // -----------------------------------------------------------
        function showToolBlockedScreen(toolName) {
            switchTab('chat'); // Garante que estamos na aba certa
            const container = document.getElementById('messagesContainer');
            if(!container) return;

            // HTML Profissional (Borda Neon Vermelha, √çcone M√£o, Bot√£o Largo)
            const blockedHTML = `
                <div class="flex flex-col items-center justify-center h-full fade-in pt-16 px-4">
                    <div class="bg-[#0a0505] border border-red-600 shadow-[0_0_60px_rgba(220,38,38,0.25)] p-8 rounded-2xl max-w-sm w-full text-center relative overflow-hidden">
                        
                        <!-- Watermark de Polvo -->
                        <div class="absolute inset-0 bg-[url('assets/polvo_synapse.png')] bg-center bg-no-repeat opacity-10 pointer-events-none bg-contain mix-blend-overlay"></div>

                        <!-- √çcone de Bloqueio -->
                        <div class="w-14 h-14 bg-red-900/20 rounded-full flex items-center justify-center mx-auto mb-6 border-2 border-red-600 text-red-500 shadow-[0_0_15px_rgba(220,38,38,0.6)]">
                            <i class="fas fa-hand-paper text-2xl"></i>
                        </div>
                        
                        <h3 class="text-white font-black text-xl mb-3 uppercase tracking-wide">Interven√ß√£o Bloqueada</h3>
                        
                        <p class="text-gray-400 text-xs mb-8 leading-relaxed font-medium">
                            O m√≥dulo <strong>${toolName}</strong> √© uma ferramenta neuroqu√≠mica avan√ßada dispon√≠vel apenas para membros do <span class="text-red-500 font-bold">Synapse PRO</span>.
                        </p>
                        
                        <button onclick="window.location.href='index.html#planos'" class="w-full py-4 bg-[#CC0000] hover:bg-red-600 text-white font-black rounded-lg uppercase tracking-[0.15em] text-[10px] shadow-lg shadow-red-900/40 transition-all transform hover:-translate-y-1 active:scale-95">
                            DESBLOQUEAR AGORA
                        </button>
                        
                        <p class="text-[9px] text-gray-600 mt-4 font-mono-code">SISTEMA PROTEGIDO v2.5</p>
                    </div>
                </div>
            `;
            
            container.innerHTML = blockedHTML;
            document.getElementById('chatInput').disabled = true;
            document.getElementById('chatInput').placeholder = "Acesso Restrito.";
        }

        // -----------------------------------------------------------
        // 5. M√ìDULO DE CHAT (Diagn√≥stico)
        // -----------------------------------------------------------
        const AGENTS = {
            Diagnostico: {
                name: "Psic√≥logo IA",
                welcome: "Oi. Sou seu analista pessoal. Como √© apenas uma demonstra√ß√£o, serei breve. O que est√° te travando hoje?",
                typewriter: ["analisando contexto...", "conectado (modo demo)."],
                initialButtons: ["Procrastina√ß√£o", "Ansiedade", "Des√¢nimo"],
                prompt: "Voc√™ √© um psic√≥logo comportamental. Seja breve e direto."
            }
        };

        let chatHistory = [];

        function initChat() {
            const sendBtn = document.getElementById('sendBtn');
            const chatInput = document.getElementById('chatInput');
            if(sendBtn) sendBtn.addEventListener('click', sendMessage);
            if(chatInput) chatInput.addEventListener('keydown', (e) => { 
                if(e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); } 
            });
            // Inicia zerado, selectTool chama o resetChat
        }

        function resetChat(agentKey = 'Diagnostico') {
            const container = document.getElementById('messagesContainer');
            if(!container) return;
            
            container.innerHTML = ''; 
            chatMessageCount = 0;
            
            document.getElementById('chatInput').disabled = false;
            document.getElementById('chatInput').placeholder = "Digite seu comando...";

            const agent = AGENTS[agentKey];
            
            const headerHTML = `
                <div class="w-full text-center mb-6 p-4">
                    <p id="chatSubtitle" class="text-gray-400 text-sm">
                        <span id="typewriter-text" class="text-brutal-red font-medium"></span>
                        <span class="animate-pulse">|</span>
                    </p>
                </div>
            `;
            container.insertAdjacentHTML('afterbegin', headerHTML);
            addIAMessage(agent.welcome);
            renderQuickReplies(agent.initialButtons);
            chatHistory = [{ role: "system", content: agent.prompt }];
            startTypewriter(agent.typewriter);
        }

        async function sendMessage() {
            const chatInput = document.getElementById('chatInput');
            const text = chatInput.value.trim();
            if(!text) return;

            if (chatMessageCount >= CHAT_LIMIT) {
                showPaywallInChat();
                chatInput.value = '';
                return;
            }

            addUserMessage(text);
            chatInput.value = '';
            chatHistory.push({ role: "user", content: text });
            chatMessageCount++;

            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'chat-message-ia opacity-50 text-xs';
            loadingDiv.id = 'loadingMsg';
            loadingDiv.innerText = `Analisando...`;
            document.getElementById('messagesContainer').appendChild(loadingDiv);
            scrollToBottom();

            try {
                const response = await fetch(CONFIG.API_URL, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ model: CONFIG.API_MODEL, messages: chatHistory, temperature: 0.7 })
                });
                loadingDiv.remove();
                const data = await response.json();
                if (!data.choices || !data.choices[0]) throw new Error("API sem resposta");
                const reply = data.choices[0].message.content;
                
                addIAMessage(reply);
                chatHistory.push({ role: "assistant", content: reply });

                if (chatMessageCount >= CHAT_LIMIT) setTimeout(showPaywallInChat, 1000);

            } catch (e) {
                if(document.getElementById('loadingMsg')) document.getElementById('loadingMsg').remove();
                addIAMessage("Erro de conex√£o na demo.", true);
            }
        }

        function showPaywallInChat() {
            const container = document.getElementById('messagesContainer');
            const paywallHTML = `
                <div class="paywall-card">
                    <i class="fa-solid fa-lock text-2xl text-red-500 mb-2"></i>
                    <h3 class="text-white font-bold text-sm uppercase">Dossi√™ Bloqueado</h3>
                    <p class="text-gray-400 text-xs mt-2 mb-4">Voc√™ atingiu o limite de intera√ß√µes da demonstra√ß√£o gratuita.</p>
                    <button onclick="window.location.href='index.html#planos'" class="bg-[#CC0000] hover:bg-red-700 text-white font-bold py-2 px-4 rounded text-xs uppercase tracking-wider w-full">
                        Desbloquear An√°lise Completa
                    </button>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', paywallHTML);
            document.getElementById('chatInput').disabled = true;
            document.getElementById('chatInput').placeholder = "Sess√£o Finalizada.";
            scrollToBottom();
        }

        function addUserMessage(text) {
            const container = document.getElementById('messagesContainer');
            const div = document.createElement('div');
            div.className = 'chat-message-user';
            div.innerText = text;
            container.appendChild(div);
            scrollToBottom();
        }

        function addIAMessage(text, isError = false) {
            const container = document.getElementById('messagesContainer');
            let cleanMessage = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>');
            const div = document.createElement('div');
            div.className = 'chat-message-ia';
            if(isError) div.style.color = '#ef4444';
            div.innerHTML = cleanMessage;
            container.appendChild(div);
            scrollToBottom();
        }

        function renderQuickReplies(buttons) {
            const container = document.getElementById('messagesContainer');
            const btnContainer = document.createElement('div');
            btnContainer.className = 'quick-reply-container';
            buttons.forEach(btnText => {
                const btn = document.createElement('button');
                btn.className = 'cyber-btn';
                btn.innerText = btnText;
                btn.onclick = () => {
                    btnContainer.style.display = 'none'; 
                    document.getElementById('chatInput').value = btnText;
                    sendMessage();
                };
                btnContainer.appendChild(btn);
            });
            container.appendChild(btnContainer);
            scrollToBottom();
        }

        function startTypewriter(phrases) {
            const el = document.getElementById('typewriter-text');
            if(!el) return;
            let pIndex = 0, cIndex = 0, isDeleting = false;
            function type() {
                const current = phrases[pIndex];
                el.textContent = current.substring(0, isDeleting ? cIndex - 1 : cIndex + 1);
                cIndex += isDeleting ? -1 : 1;
                let speed = isDeleting ? 50 : 100;
                if(!isDeleting && cIndex === current.length) { isDeleting = true; speed = 2000; }
                else if(isDeleting && cIndex === 0) { isDeleting = false; pIndex = (pIndex + 1) % phrases.length; speed = 500; }
                setTimeout(type, speed);
            }
            type();
        }

        function scrollToBottom() {
            const container = document.getElementById('messagesContainer');
            const parent = container.parentElement;
            if(parent) parent.scrollTop = parent.scrollHeight;
        }

        // -----------------------------------------------------------
        // 6. M√ìDULO DASHBOARD (Limitado)
        // -----------------------------------------------------------
        let localMissions = []; 

        function initDashboard() {
            setupInput();
            renderMissions();
        }

        function renderMissions() {
            const list = document.getElementById('tactical-list');
            list.innerHTML = '';
            
            if (localMissions.length === 0) {
                list.innerHTML = '<div class="text-center py-8 text-gray-700 text-xs">Adicione uma miss√£o para testar o sistema.<br>(Limite: 1 na Demo)</div>';
                updateMeta();
                return;
            }

            localMissions.forEach(m => {
                const div = document.createElement('div');
                div.className = `group flex items-center gap-3 bg-[#111] hover:bg-[#161616] p-3 rounded-lg border border-transparent hover:border-white/5 transition mb-2 ${m.completed ? 'opacity-50' : ''}`;
                div.innerHTML = `
                    <button class="check-btn w-5 h-5 rounded border ${m.completed ? 'bg-green-500 border-green-500 text-black' : 'border-[#444] hover:border-white'} flex items-center justify-center transition">
                        ${m.completed ? '<i class="fa-solid fa-check text-[10px]"></i>' : ''}
                    </button>
                    <input type="text" readonly value="${m.title}" class="bg-transparent text-sm w-full outline-none ${m.completed ? 'text-gray-500 line-through' : 'text-gray-200'}">
                    <button class="del-btn text-gray-700 hover:text-red-500 opacity-0 group-hover:opacity-100 transition px-2"><i class="fa-solid fa-trash text-xs"></i></button>
                `;
                div.querySelector('.check-btn').onclick = () => {
                    m.completed = !m.completed;
                    if(m.completed) {
                        const xpBar = document.getElementById('xpBar');
                        if(xpBar) xpBar.style.width = '20%';
                        if(window.confetti) confetti({ particleCount: 50, spread: 40, origin: { y: 0.7 } });
                    }
                    renderMissions();
                };
                div.querySelector('.del-btn').onclick = () => {
                    localMissions = localMissions.filter(item => item.id !== m.id);
                    renderMissions();
                };
                list.appendChild(div);
            });
            updateMeta();
        }

        function setupInput() {
            const btn = document.getElementById('btnAddBlock');
            const input = document.getElementById('newMissionInput');
            const newBtn = btn.cloneNode(true);
            btn.parentNode.replaceChild(newBtn, btn);

            const addFn = () => {
                const title = input.value.trim();
                if(!title) return;
                if (localMissions.length >= MISSION_LIMIT) {
                    alert("üîí LIMITE DE DEMO ATINGIDO\n\nNa vers√£o gratuita, voc√™ pode testar com apenas 1 miss√£o ativa.\n\nDesbloqueie o PRO para miss√µes ilimitadas.");
                    return;
                }
                input.value = '';
                localMissions.push({ id: Date.now(), title: title, completed: false });
                renderMissions();
            };
            newBtn.onclick = addFn;
            input.onkeydown = (e) => { if(e.key === 'Enter') addFn(); };
        }

        function updateMeta() {
            const done = localMissions.filter(m => m.completed).length;
            const total = localMissions.length > 0 ? localMissions.length : 1; 
            const pct = Math.round((done/total)*100);
            
            document.getElementById('dailyMetaText').innerText = `${done}/${localMissions.length}`;
            document.querySelector('.circle-content').innerText = `${pct}%`;
            document.querySelector('.circle-chart').style.setProperty('--percentage', `${pct * 3.6}deg`);
        }

        // -----------------------------------------------------------
        // 7. INICIALIZA√á√ÉO
        // -----------------------------------------------------------
        document.addEventListener('DOMContentLoaded', async () => {
            console.log("üöÄ Inicializando Synapse (Modo DEMO)...");
            
            initNavigation();
            initChat();
            initDashboard();
            
            // Inicia com Diagn√≥stico (Sem anima√ß√£o de crise)
            selectTool('Diagnostico');

            // For√ßar abertura da sidebar no mobile
            if (window.innerWidth < 768) {
                setTimeout(() => toggleSidebar(), 100);
            }
            
            const calGrid = document.getElementById('cal-grid');
            if(calGrid) {
                for(let i=1; i<=30; i++) {
                    const d = document.createElement('div');
                    d.className = 'aspect-square rounded border border-[#222] flex items-center justify-center text-[10px] text-[#444]';
                    d.innerText = i;
                    calGrid.appendChild(d);
                }
            }

            document.body.style.visibility = "visible";
            if(window.lucide) lucide.createIcons();
        });
        
        // Listeners Extras
        document.getElementById('btnFoco').onclick = () => showLockedFeature("Modo Foco");
        document.getElementById('btnRelatorio').onclick = () => showLockedFeature("Relat√≥rios Avan√ßados");
        
        // Fallback global para evitar erros
        window.triggerPanicSequence = () => selectTool('Panico');
    </script>
</body>
</html>